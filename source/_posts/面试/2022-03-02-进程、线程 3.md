---
title: 进程、线程 3
date: 2022-03-02 23:39:12 +0800
categories: 操作系统
tag: 进程、线程
mathjax: true
---
# 进程、线程

## 并发、同步、异步、互斥、阻塞、非阻塞

### 并发、同步、异步、互斥、阻塞、非阻塞的基本概念
- 并发
  - 在操作系统中，同个处理机上有多个程序同时运行。
- 同步、异步
  - 同步：顺序执行，执行完一个再执行下一个，需要等待、协调运行。
  - 异步：异步和同步是相对的，异步就是彼此独立，在等待某事件的过程中继续做自己的事，不需要等待这一事件完成后再工作。
    - 线程是实现异步的一个方式。可以在主线程创建一个新线程来做某件事，此时主线程不需要等待子线程做完而是可以做其他事情。
    - 异步和多线程并不是一个同等关系，异步是最终目的，多线程只是实现异步的一种手段。
  - 同步和异步是对应的，是线程之间的关系。两个线程要么同步要么异步。
- 阻塞、非阻塞
  - 当进程在访问数据时，根据IO操作的就绪状态不同而采取不同的处理方式。比如主程序调用一个函数要读取一个文件的内容：
    - 阻塞方式下主程序会等到函数读取完再继续往下执行。
    - 非阻塞方式下读取函数会立刻返回一个状态值给主程序，主程序不等待文件读取完就继续往下执行。
    - 要注意的是阻塞和非阻塞说明的是IO和CPU之间的关系，即CPU是否等待IO。
- 一般有以下4类IO模型，考虑发送方发出请求要接收方读取某文件内容为例：
    - 同步阻塞IO
      - 发送方发出请求后一直等待(同步)。接收方开始读取文件，如果不能马上得到读取结果就一直等待，直到获取读取结果再响应发送方，等待期间不可做其他操作(阻塞)。
    - 同步非阻塞IO
      - 发送方发出请求后一直等待(同步)。接收方开始读取文件，如果不能马上得到读取结果就一直等待，就立即返回，接受方继续去做其他事情。此时并未响应发送方，发送方一直等待。直到IO操作(读取文件)完成后，接收方获得读取结果响应发送方，接收方才可以进入下一次请求过程(非阻塞)。
    - 异步阻塞IO(理论存在，实际不用)
      - 发送方发出请求后，不等待响应，继续其他工作(异步)。接收方读取文件如果不能马上得到结果，就一直等到返回结果后，才响应发送方，期间不能进行其他操作。
    - 异步非阻塞IO(效率最高)
      - 发送方发出请求后，不等待响应，继续其他工作(异步)。接收方读取文件如果不能马上得到结果，也不等待，而是马上返回去做其他事情。当IO操作(读取文件)完成以后，将完成状态和结果通知接收方，接收方再响应发送方。
  - 阻塞和非阻塞是对同一个线程的某个时刻来说的。此时，线程要么阻塞，要么非阻塞。
- 阻塞是使用同步机制的结果，非阻塞是使用异步机制的结果。

### 线程的同步和互斥
- 线程互斥
  - 当有若干个线程同时访问同一块资源时，规定同一时间只有一个线程可以得到访问权，其他线程需要等待占用资源者释放该资源才可以申请访问。
  - 互斥无法限制访问者对资源的访问顺序，即访问是无序的。
- 线程同步：
  - 在互斥的基础上(大多数情况，除非允许同一时间多个访问者访问同一资源)，通过其它机制实现访问者对资源的有序访问，实现每个线程之间按预定的先后次序进行运行，协同、协助、互相配合。

### 线程同步与阻塞的关系
- 同步是过程，阻塞是状态
  - 当多个线程访问同一资源时，规定同一时间只有一个线程可进行访问，所以后访问的线程将被阻塞，等待先访问的线程访问完。
- 线程同步不一定发生阻塞。只有当访问同一资源出现互相等待和互相唤醒才会发生阻塞。而阻塞了一定是同步，多线程用阻塞实现同步。