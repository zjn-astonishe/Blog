---
title: Zigbee协议栈 1
date: 2022-02-27 21:05:20 +0800
categories: ZigBee开发
tag: ZigBee
mathjax: true
---

# Zigbee协议栈

## Zigbee协议栈简介

### 协议和协议栈
- 协议是一系列的通信标准，通信双方需要共同按照这一标准进行正常的数据发射和接收。
- 协议栈是协议的具体实现形式，即协议和用户之间的一个接口。开发人员通过协议栈使用协议，进而实现无线数据收发。

### Zigbee协议栈架构
![Zigbee无线网络协议层](https://github.com/zjn-astonishe/image/blob/main/Zigbee/Zigbee%E6%97%A0%E7%BA%BF%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AE%E5%B1%82.png?raw=true)
- Zigbee协议分为两部分：
  - IEEE802.15.4定义了PHY(物理层)和MAC(介质访问层)技术规范。
  - Zigbee联盟定义了NWK(网络层)、APS(应用程序支持子层)、APL(应用层)技术规范。
- Zigbee协议栈就是将各个层定义的协议都集合在一起，以函数的形式实现，并给用户提供API(应用层)，用户可以直接调用。

### Z-stack
- Z-stack是挪威半导体公司Chipcon(目前已经被TI公司收购)推出其CC2430(现在基本使用的是CC2530)开发平台时，推出的一款业界领先的商业级协议栈软件。
- 由于这个软件协议栈软件的出现，用户可以很容易开发出具体的应用程序(常说的掌握10个函数就能使用Zigbee通讯)。
- 使用瑞典公司IAR开发的IAR Embedded Workbench for MCS-51作为集成开发环境。
- Chipcon公司为自己设计的Z-Stack协议栈中提供了一个名为操作系统抽象层OSAL的协议栈调度程序。
  - 对于用户来说，除了能够看到OSAL调度程序外，其他任何协议栈操作的具体实现细节都被封装在库代码中。
  - 用户在进行具体的应用开发时，只能够通过调用API接口进行，而无权知道Zigbee协议栈实现的具体细节。只需要知道应用层的数据是使用哪些函数，通过什么方式把数据发送出去或者把数据接收过来的。

### Z-stack体系架构深度剖析
- Z-stack的体系结构由称为层的各模块组成。每一层为上层提供特定的服务：
  - 由数据服务实体提供数据传输服务
  - 由管理实体提供所有的其他管理服务。
- 每个服务实体通过相应的服务接入点(SAP)为其上层提供了一个接口，每个服务接入点通过服务原语来完成所以对应的功能。
![Z-stack体系结构](https://github.com/zjn-astonishe/image/blob/main/Zigbee/Z-stack%E4%BD%93%E7%B3%BB%E7%BB%93%E6%9E%84.png?raw=true)
- Z-stack根据IEEE802.15.4和Zigbee标准分为：
  - 物理层(PHY)：物理层定义了物理无线信道和MAC子层之间的接口，提供物理层数据服务和物理层管理服务，物理层内容：
    - Zigbee的激活
    - 当前信道的能量检测
    - 接收链路服务质量信息
    - Zigbee信道接入方式
    - 信道频率选择
    - 数据传输和接收
  - 介质接入控制子层(MAC)：MAC层负责处理所有的物理无线信道访问，并产生网络信号、同步信号；支持PAN连接和分离，提供两个对等MAC实体之间可靠的链路。MAC层功能：
    - 网络协调器产生信标
    - 与信标同步
    - 支持PAN(个域网)链路的建立和断开
    - 为设备安全性提供支持
    - 信道接入方式采用免冲突载波检测多址接入(CSMA-CA)机制
    - 处理和维护保护时隙(GTS)机制
    - 在两个对等的MAC实体之间提供一个可靠的通信链路
  - 网络层(NWK)：Z-stack的核心部分。网络层主要实现节点加入或离开网络、接收或抛弃其他节点、路由查找及传送数据等功能。网络层功能：
    - 网络发现
    - 网络形成
    - 允许设备连接
    - 路由器初始化
    - 设备同网络连接
    - 直接将设备同网络连接
    - 断开网络连接
    - 重新复位设备
    - 接收机同步
    - 信息库维护
  - 应用层(APL)：提供一些必要函数以及为网络层提供合适的服务接口，定义自己的应用对象。
    - 应用层框架包括
      - 应用支持层(APS)
        - 主要功能是：维持绑定表、在绑定的设备之间传送信息
      - Zigbee设备对象(ZDO)
        - 主要功能是：定义设备在网络中的角色(协调器还是终端)、发起和响应绑定请求、在网络设备之间建立安全机制、发现网络中的设备并决定提供何种应用服务。
      - 制造商所定义的应用对象。
        - 应用程序框架(AF)：运行在Zigbee协议栈上的应用程序实际上就是厂商自定义的应用对象，并且遵循规范(profile)运行在端点1~240上。在Zigbee应用中，提供键值对(KVP)或报文(MSG)两种标准服务类型。