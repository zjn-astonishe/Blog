---
title: RK3568 Linux的I2C总线驱动分析
date: 2022-08-09 17:26:37 +0800
categories: [Linux, RK3568, I2C驱动, 代码分析]
tag: [Linux设备驱动, RK3568]
mathjax: true
---

# RK3568 Linux的I2C总线驱动分析

## 前言

根据I2C驱动的开发流程分析RK3568 Linux的I2C总线驱动。

由《Linux设备驱动开发详解》一书第15章《Linux I2C核心、总线与设备驱动》可知，在Linux系统中，I2C驱动由3部分组成，即I2C核心，I2C总线驱动和I2C设备驱动。

而RK3568作为被设备挂载的控制器(适配器)，其驱动程序—— `.../OpenHarmony/out/kernel/src_tmp/linux-5.10/drivers/i2c/busses/i2c-rk3x.c` ，应属于I2C总线驱动。

## RK3568 I2C总线驱动概述

* 文件路径
  + `.../OpenHarmony/out/kernel/src_tmp/linux-5.10/drivers/i2c/busses/i2c-rk3x.c`
* 总线驱动：`rk3x_i2c_driver`：
  + probe方法：`rk3x_i2c_probe`
  + remove方法：`rk3x_i2c_remove`
* 通信方法集合：`rk3x_i2c_algorithm`
  + 通信方法：`rk3x_i2c_xfer`
  + 功能检测方法：`rk3x_i2c_func`
* 驱动注册和卸载方法
  + 注册方法：`rk3x_i2c_driver_init`
  + 卸载方法：`rk3x_i2c_driver_exit`

## RK3568 I2C总线驱动分析

### 定义总线驱动

### 定义algorithm通信方法

### 设备树的分配方法

### 注册平台驱动

### 总线驱动函数

#### 初始化函数probe()

#### 释放函数remove()

#### 通信方法函数xfer()

#### 功能检测函数func()

#### 总线驱动模块注册函数init()

#### 总线驱动模块卸载函数exit()
